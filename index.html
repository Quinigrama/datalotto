          <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé≤ DataLotto49 - Generador Inteligente de Loter√≠a</title>
<meta name="description" content="Generador profesional de combinaciones de loter√≠a con an√°lisis estad√≠stico avanzado">
<style>
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #8b5cf6;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --info: #06b6d4;
  --dark: #1f2937;
  --light: #f9fafb;
  --gray: #6b7280;
  --border-radius: 12px;
  --shadow: 0 4px 6px-1px rgba(0, 0, 0, 0.1), 0 2px 4px-1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px-3px rgba(0, 0, 0, 0.1), 0 4px 6px-2px rgba(0, 0, 0, 0.05);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  min-height: 100vh;
  padding: 20px;
  color: var(--dark);
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px;
  background: white;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.header h1 {
  color: var(--primary);
  font-size: 2.5rem;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.header p {
  color: var(--gray);
  font-size: 1.1rem;
}

.main-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

@media(max-width: 992px) {
  .main-grid {
    grid-template-columns: 1fr;
  }
}

.game-section {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.selected-numbers {
  background: white;
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.selected-numbers h3 {
  color: var(--primary);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.selected-display {
  min-height: 60px;
  border: 2px dashed #e5e7eb;
  border-radius: 8px;
  padding: 15px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: center;
}

.number-selection-section {
  background: white;
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.number-selection-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.number-selection-header h3 {
  color: var(--primary);
}

.selection-mode-controls {
  display: flex;
  gap: 10px;
}

.selection-mode-btn {
  width: 40px;
  height: 40px;
  border: 2px solid #e5e7eb;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
}

.selection-mode-btn:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
}

.selection-mode-btn.active {
  border-color: var(--primary);
  background: var(--primary);
  color: white;
}

.numbers-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
}

@media(max-width: 768px) {
  .numbers-grid {
    grid-template-columns: repeat(7, 1fr);
  }
}

.number-ball {
  width: 100%;
  aspect-ratio: 1;
  background: #f3f4f6;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid transparent;
}

.number-ball:hover {
  transform: scale(1.1);
  border-color: var(--primary);
}

.number-ball.selected {
  background: var(--primary);
  color: white;
  transform: scale(1.1);
}

.number-ball.cold {
  background: #3b82f6;
  color: white;
}

.number-ball.hot {
  background: #ef4444;
  color: white;
}

.number-ball.excluded {
  background: #6b7280;
  color: white;
  opacity: 0.7;
}

.stats-section {
  background: white;
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.stats-section h3 {
  color: var(--primary);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

@media(max-width: 576px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
}

.stat-item {
  padding: 12px;
  background: #f9fafb;
  border-radius: 8px;
  border-left: 4px solid var(--primary);
}

.stat-label {
  font-size: 0.9rem;
  color: var(--gray);
  margin-bottom: 5px;
}

.stat-value {
  font-weight: bold;
  color: var(--dark);
}

.stat-value.valid {
  color: var(--success);
}

.stat-value.invalid {
  color: var(--danger);
}

.sidebar {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.panel {
  background: white;
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.panel h3 {
  color: var(--primary);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.strategy-buttons {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}

.strategy-btn {
  background: #f9fafb;
  border: 2px solid #e5e7eb;
  border-radius: var(--border-radius);
  padding: 15px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
}

.strategy-btn:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
}

.strategy-btn.active {
  border-color: var(--primary);
  background: var(--primary);
  color: white;
}

.multiple-options {
  background: #f9fafb;
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
}

.input-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.input-row input, .input-row select {
  padding: 8px 12px;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  width: 80px;
}

.action-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.btn {
  padding: 12px 20px;
  border: none;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-weight: bold;
  transition: var(--transition);
  text-align: center;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #059669;
  transform: translateY(-2px);
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-danger:hover {
  background: #dc2626;
  transform: translateY(-2px);
}

.filter-section {
  background: white;
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.filter-group {
  margin-bottom: 20px;
}

.filter-title {
  font-weight: bold;
  color: var(--dark);
  margin-bottom: 10px;
}

.filter-options {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.filter-chip {
  padding: 6px 12px;
  background: #f3f4f6;
  border: 1px solid #e5e7eb;
  border-radius: 20px;
  font-size: 0.85rem;
  cursor: pointer;
  transition: var(--transition);
}

.filter-chip:hover {
  border-color: var(--primary);
}

.filter-chip.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--success);
  color: white;
  padding: 15px 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-lg);
  z-index: 1000;
  transform: translateX(100%);
  transition: var(--transition);
}

.toast.show {
  transform: translateX(0);
}

.toast.error {
  background: var(--danger);
}

.loading-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.loading-content {
  background: white;
  padding: 30px;
  border-radius: var(--border-radius);
  text-align: center;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #e5e7eb;
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üé≤ DataLotto49</h1>
    <p>Generador Inteligente de Combinaciones de Loter√≠a</p>
  </div>

  <div class="main-grid">
    <div class="game-section">
      <!-- N√∫meros Seleccionados -->
      <div class="selected-numbers">
        <h3>üéØ N√∫meros Seleccionados</h3>
        <div class="selected-display" id="selectedDisplay">
          <div style="color:#666; font-style: italic;">Selecciona hasta 6 n√∫meros</div>
        </div>
      </div>

      <!-- Selecci√≥n de N√∫meros -->
      <div class="number-selection-section">
        <div class="number-selection-header">
          <h3>üî¢ Selecci√≥n de N√∫meros</h3>
          <div class="selection-mode-controls">
            <div class="selection-mode-btn active" title="Seleccionar" data-mode="select">‚úì</div>
            <div class="selection-mode-btn" title="N√∫meros Calientes" data-mode="hot">üî•</div>
            <div class="selection-mode-btn" title="N√∫meros Fr√≠os" data-mode="cold">‚ùÑÔ∏è</div>
            <div class="selection-mode-btn" title="Excluir" data-mode="exclude">‚ùå</div>
          </div>
        </div>
        <div class="numbers-grid">
          <!-- Los n√∫meros se generan din√°micamente -->
        </div>
      </div>

      <!-- Estad√≠sticas -->
      <div class="stats-section">
        <h3>üìä Estad√≠sticas en Tiempo Real</h3>
        <div class="stats-grid" id="statsGrid">
          <div class="stat-item">
            <div class="stat-label">Suma Total</div>
            <div class="stat-value" id="statSuma">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Par/Impar</div>
            <div class="stat-value" id="statParImpar">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Bajos/Altos</div>
            <div class="stat-value" id="statBajosAltos">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Decenas</div>
            <div class="stat-value" id="statDecenas">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Agrup. Decenas</div>
            <div class="stat-value" id="statAgrupDecenas">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Consecutivos</div>
            <div class="stat-value" id="statConsecutivos">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Suma D√≠gitos</div>
            <div class="stat-value" id="statSumaDigitos">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">N√∫meros Primos</div>
            <div class="stat-value" id="statPrimos">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Desviaci√≥n</div>
            <div class="stat-value" id="statDesviacion">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Patrones</div>
            <div class="stat-value" id="statPatrones">-</div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <!-- Estrategia de Juego -->
      <div class="panel">
        <h3>‚ôü Estrategia de Juego</h3>
        <div class="strategy-buttons">
          <div class="strategy-btn active" data-strategy="simple">
            <div style="font-size: 1.5rem; margin-bottom: 5px;">üéØ</div>
            <div>Simple</div>
          </div>
          <div class="strategy-btn" data-strategy="winning">
            <div style="font-size: 1.5rem; margin-bottom: 5px;">üèÜ</div>
            <div>Estrategia Ganadora</div>
          </div>
          <div class="strategy-btn" data-strategy="multiple">
            <div style="font-size: 1.5rem; margin-bottom: 5px;">üé∞</div>
            <div>M√∫ltiple</div>
          </div>
        </div>

        <!-- Opciones para Estrategia Ganadora -->
        <div class="multiple-options" id="winningOptions" style="display: none;">
          <div class="input-row">
            <label>Generar:</label>
            <input type="number" id="generateCount" value="100" min="10" max="1000">
            <span>combinaciones</span>
          </div>
          <div class="input-row">
            <label>Jugar:</label>
            <input type="number" id="playCount" value="10" min="1" max="100">
            <span>mejores</span>
          </div>
        </div>

        <!-- Opciones para M√∫ltiple -->
        <div class="multiple-options" id="multipleOptions" style="display: none;">
          <div class="input-row">
            <label>N√∫meros:</label>
            <select id="multipleNumbers">
              <option value="8">8 n√∫meros</option>
              <option value="9">9 n√∫meros</option>
              <option value="10">10 n√∫meros</option>
              <option value="11">11 n√∫meros</option>
              <option value="12">12 n√∫meros</option>
            </select>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" onclick="app.generateCombination()">üé≤ Generar</button>
          <button class="btn btn-success" onclick="app.clearAll()">üóëÔ∏è Limpiar</button>
        </div>
      </div>

      <!-- Filtros Avanzados -->
      <div class="panel">
        <h3>üéõÔ∏è Filtros Avanzados</h3>
        
        <div class="filter-group">
          <div class="filter-title">‚öñÔ∏è Par/Impar</div>
          <div class="filter-options" id="parImparOptions">
            <div class="filter-chip" data-value="6/0">6/0</div>
            <div class="filter-chip" data-value="5/1">5/1</div>
            <div class="filter-chip active" data-value="4/2">4/2</div>
            <div class="filter-chip active" data-value="3/3">3/3</div>
            <div class="filter-chip active" data-value="2/4">2/4</div>
            <div class="filter-chip" data-value="1/5">1/5</div>
            <div class="filter-chip" data-value="0/6">0/6</div>
          </div>
        </div>

        <div class="filter-group">
          <div class="filter-title">üìä Bajos/Altos (1-25/26-49)</div>
          <div class="filter-options" id="bajosAltosOptions">
            <div class="filter-chip" data-value="6/0">6/0</div>
            <div class="filter-chip" data-value="5/1">5/1</div>
            <div class="filter-chip active" data-value="4/2">4/2</div>
            <div class="filter-chip active" data-value="3/3">3/3</div>
            <div class="filter-chip active" data-value="2/4">2/4</div>
            <div class="filter-chip" data-value="1/5">1/5</div>
            <div class="filter-chip" data-value="0/6">0/6</div>
          </div>
        </div>

        <div class="filter-group">
          <div class="filter-title">üî¢ Agrupaci√≥n por Decenas</div>
          <div class="filter-options" id="agrupDecenasOptions">
            <div class="filter-chip active" data-value="6">6</div>
            <div class="filter-chip active" data-value="5/1">5/1</div>
            <div class="filter-chip active" data-value="4/2">4/2</div>
            <div class="filter-chip active" data-value="4/1/1">4/1/1</div>
            <div class="filter-chip active" data-value="3/3">3/3</div>
            <div class="filter-chip active" data-value="3/2/1">3/2/1</div>
            <div class="filter-chip active" data-value="3/1/1/1">3/1/1/1</div>
            <div class="filter-chip active" data-value="2/2/2">2/2/2</div>
            <div class="filter-chip active" data-value="2/2/1/1">2/2/1/1</div>
            <div class="filter-chip active" data-value="2/1/1/1/1">2/1/1/1/1</div>
            <div class="filter-chip active" data-value="1/1/1/1/1/1">1/1/1/1/1/1</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Carga -->
<div class="loading-modal" id="loadingModal">
  <div class="loading-content">
    <div class="spinner"></div>
    <div id="loadingText">Generando combinaci√≥n...</div>
  </div>
</div>

<!-- Toast de Notificaciones -->
<div class="toast" id="toast"></div>

<script>
class DataLotto49 {
  constructor() {
    this.selectedNumbers = [];
    this.hotNumbers = new Set();
    this.coldNumbers = new Set();
    this.excludedNumbers = new Set();
    this.currentMode = 'select';
    this.currentStrategy = 'simple';
    this.filters = {
      parImpar: new Set(['4/2', '3/3', '2/4']),
      bajosAltos: new Set(['4/2', '3/3', '2/4']),
      agrupDecenas: new Set(['6', '5/1', '4/2', '4/1/1', '3/3', '3/2/1', '3/1/1/1', '2/2/2', '2/2/1/1', '2/1/1/1/1', '1/1/1/1/1/1'])
    };
    this.init();
  }

  init() {
    this.createNumbersGrid();
    this.setupEventListeners();
    this.updateDisplay();
  }

  createNumbersGrid() {
    const grid = document.querySelector('.numbers-grid');
    grid.innerHTML = '';
    
    for(let i = 1; i <= 49; i++) {
      const ball = document.createElement('div');
      ball.className = 'number-ball';
      ball.dataset.number = i;
      ball.innerHTML = `<span>${i}</span>`;
      ball.addEventListener('click', () => this.handleNumberClick(i, ball));
      grid.appendChild(ball);
    }
  }

  setupEventListeners() {
    // Event listeners para modos de selecci√≥n
    document.querySelectorAll('.selection-mode-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.selection-mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        this.currentMode = btn.dataset.mode;
      });
    });

    // Event listeners para estrategias
    document.querySelectorAll('.strategy-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        this.currentStrategy = btn.dataset.strategy;
        this.showStrategyOptions();
      });
    });

    // Event listeners para filtros
    document.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', (e) => {
        chip.classList.toggle('active');
        this.updateFilters();
      });
    });
  }

  handleNumberClick(number, ball) {
    switch(this.currentMode) {
      case 'select':
        this.toggleNumberSelection(number, ball);
        break;
      case 'hot':
        this.toggleHotNumber(number, ball);
        break;
      case 'cold':
        this.toggleColdNumber(number, ball);
        break;
      case 'exclude':
        this.toggleExcludedNumber(number, ball);
        break;
    }
    this.updateDisplay();
    this.calculateStats();
  }

  toggleNumberSelection(number, ball) {
    if(this.selectedNumbers.includes(number)) {
      this.selectedNumbers = this.selectedNumbers.filter(n => n !== number);
      ball.classList.remove('selected');
    } else if(this.selectedNumbers.length < 6) {
      this.selectedNumbers.push(number);
      ball.classList.add('selected');
    } else {
      this.showToast('M√°ximo 6 n√∫meros seleccionados', true);
    }
  }

  toggleHotNumber(number, ball) {
    if(this.hotNumbers.has(number)) {
      this.hotNumbers.delete(number);
      ball.classList.remove('hot');
    } else {
      this.hotNumbers.add(number);
      ball.classList.add('hot');
    }
  }

  toggleColdNumber(number, ball) {
    if(this.coldNumbers.has(number)) {
      this.coldNumbers.delete(number);
      ball.classList.remove('cold');
    } else {
      this.coldNumbers.add(number);
      ball.classList.add('cold');
    }
  }

  toggleExcludedNumber(number, ball) {
    if(this.excludedNumbers.has(number)) {
      this.excludedNumbers.delete(number);
      ball.classList.remove('excluded');
    } else {
      this.excludedNumbers.add(number);
      ball.classList.add('excluded');
    }
  }

  updateDisplay() {
    const selectedDisplay = document.getElementById('selectedDisplay');
    selectedDisplay.innerHTML = '';

    if(this.selectedNumbers.length === 0) {
      selectedDisplay.innerHTML = '<div style="color:#666; font-style: italic;">Selecciona hasta 6 n√∫meros</div>';
    } else {
      this.selectedNumbers.sort((a, b) => a - b).forEach(num => {
        const span = document.createElement('span');
        span.style.background = '#6366f1';
        span.style.color = 'white';
        span.style.padding = '8px 12px';
        span.style.borderRadius = '20px';
        span.style.fontWeight = 'bold';
        span.textContent = num;
        selectedDisplay.appendChild(span);
      });
    }
  }

  calculateStats() {
    if(this.selectedNumbers.length === 0) {
      this.clearStats();
      return;
    }

    const numbers = [...this.selectedNumbers].sort((a, b) => a - b);

    // Suma total
    const suma = numbers.reduce((a, b) => a + b, 0);
    this.updateStat('Suma', suma, suma >= 120 && suma <= 200);

    // Par/Impar
    const pares = numbers.filter(n => n % 2 === 0).length;
    const impares = 6 - pares;
    const parImparStr = `${pares}/${impares}`;
    this.updateStat('ParImpar', parImparStr, this.filters.parImpar.has(parImparStr));

    // Bajos/Altos
    const bajos = numbers.filter(n => n <= 25).length;
    const altos = 6 - bajos;
    const bajosAltosStr = `${bajos}/${altos}`;
    this.updateStat('BajosAltos', bajosAltosStr, this.filters.bajosAltos.has(bajosAltosStr));

    // Decenas
    const decenas = this.getDecenas(numbers);
    this.updateStat('Decenas', decenas, true);

    // Agrupaci√≥n por decenas
    const agrupDecenas = this.getAgrupacionDecenas(numbers);
    this.updateStat('AgrupDecenas', agrupDecenas, this.filters.agrupDecenas.has(agrupDecenas));

    // Consecutivos
    const consecutivos = this.getConsecutivos(numbers);
    this.updateStat('Consecutivos', consecutivos, consecutivos <= 2);

    // Suma de d√≠gitos
    const sumaDigitos = this.getSumaDigitos(numbers);
    this.updateStat('SumaDigitos', sumaDigitos, true);

    // N√∫meros primos
    const primos = this.getPrimos(numbers);
    this.updateStat('Primos', primos, primos >= 1 && primos <= 3);

    // Desviaci√≥n est√°ndar
    const desviacion = this.getDesviacion(numbers);
    this.updateStat('Desviacion', desviacion.toFixed(1), true);

    // Patrones
    const patrones = this.getPatrones(numbers);
    this.updateStat('Patrones', patrones, true);
  }

  getDecenas(numbers) {
    const decenas = new Set();
    numbers.forEach(n => {
      if(n <= 9) decenas.add('1-9');
      else if(n <= 19) decenas.add('10-19');
      else if(n <= 29) decenas.add('20-29');
      else if(n <= 39) decenas.add('30-39');
      else decenas.add('40-49');
    });
    return decenas.size;
  }

  getAgrupacionDecenas(numbers) {
    const grupos = {};
    numbers.forEach(n => {
      const decena = Math.floor((n - 1) / 10);
      grupos[decena] = (grupos[decena] || 0) + 1;
    });
    
    const valores = Object.values(grupos).sort((a, b) => b - a);
    return valores.join('/');
  }

  getConsecutivos(numbers) {
    let consecutivos = 0;
    for(let i = 1; i < numbers.length; i++) {
      if(numbers[i] === numbers[i-1] + 1) {
        consecutivos++;
      }
    }
    return consecutivos;
  }

  getSumaDigitos(numbers) {
    return numbers.reduce((sum, num) => {
      return sum + String(num).split('').reduce((s, d) => s + parseInt(d), 0);
    }, 0);
  }

  getPrimos(numbers) {
    const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
    return numbers.filter(n => primes.includes(n)).length;
  }

  getDesviacion(numbers) {
    const media = numbers.reduce((a, b) => a + b, 0) / numbers.length;
    const varianza = numbers.reduce((sum, num) => sum + Math.pow(num - media, 2), 0) / numbers.length;
    return Math.sqrt(varianza);
  }

  getPatrones(numbers) {
    // An√°lisis de patrones simples
    const gaps = [];
    for(let i = 1; i < numbers.length; i++) {
      gaps.push(numbers[i] - numbers[i-1]);
    }
    return gaps.join('-');
  }

  updateStat(statName, value, isValid) {
    const element = document.getElementById(`stat${statName}`);
    if(element) {
      element.textContent = value;
      element.className = `stat-value ${isValid ? 'valid' : 'invalid'}`;
    }
  }

  clearStats() {
    const statIds = ['statSuma', 'statParImpar', 'statBajosAltos', 'statDecenas', 'statAgrupDecenas', 'statConsecutivos', 'statSumaDigitos', 'statPrimos', 'statDesviacion', 'statPatrones'];
    statIds.forEach(id => {
      const element = document.getElementById(id);
      if(element) {
        element.textContent = '-';
        element.className = 'stat-value';
      }
    });
  }

  showStrategyOptions() {
    document.getElementById('winningOptions').style.display = this.currentStrategy === 'winning' ? 'block' : 'none';
    document.getElementById('multipleOptions').style.display = this.currentStrategy === 'multiple' ? 'block' : 'none';
  }

  generateCombination() {
    this.showLoadingModal();
    
    setTimeout(() => {
      switch(this.currentStrategy) {
        case 'simple':
          this.generateSimpleCombination();
          break;
        case 'winning':
          this.generateWinningStrategy();
          break;
        case 'multiple':
          this.generateMultipleCombination();
          break;
      }
      this.hideLoadingModal();
    }, 500);
  }

  generateSimpleCombination() {
    const availableNumbers = Array.from({length: 49}, (_, i) => i + 1)
      .filter(num => !this.excludedNumbers.has(num));

    const selected = [];
    const tempAvailable = [...availableNumbers];
    
    while(selected.length < 6 && tempAvailable.length > 0) {
      const randomIndex = Math.floor(Math.random() * tempAvailable.length);
      selected.push(tempAvailable.splice(randomIndex, 1)[0]);
    }

    this.selectedNumbers = selected.sort((a, b) => a - b);
    this.updateNumberDisplay();
    this.updateDisplay();
    this.calculateStats();
    this.showToast('‚úÖ Combinaci√≥n simple generada');
  }

  generateWinningStrategy() {
    const generateCount = parseInt(document.getElementById('generateCount').value) || 100;
    const playCount = parseInt(document.getElementById('playCount').value) || 10;
    
    let bestCombination = null;
    let bestScore = -1;

    for(let i = 0; i < generateCount; i++) {
      const candidate = this.generateValidatedCombination();
      const score = this.evaluateCombination(candidate);
      
      if(score > bestScore) {
        bestScore = score;
        bestCombination = candidate;
      }
    }

    if(bestCombination) {
      this.selectedNumbers = bestCombination;
      this.updateNumberDisplay();
      this.updateDisplay();
      this.calculateStats();
      this.showToast(`üèÜ Estrategia ganadora aplicada (${generateCount} generadas, puntuaci√≥n: ${bestScore.toFixed(2)})`);
    }
  }

  generateMultipleCombination() {
    const numCount = parseInt(document.getElementById('multipleNumbers').value) || 8;
    const availableNumbers = Array.from({length: 49}, (_, i) => i + 1)
      .filter(num => !this.excludedNumbers.has(num));

    const selected = [];
    const tempAvailable = [...availableNumbers];
    
    while(selected.length < numCount && tempAvailable.length > 0) {
      const randomIndex = Math.floor(Math.random() * tempAvailable.length);
      selected.push(tempAvailable.splice(randomIndex, 1)[0]);
    }

    // Tomar solo los primeros 6 para mostrar
    this.selectedNumbers = selected.slice(0, 6).sort((a, b) => a - b);
    this.updateNumberDisplay();
    this.updateDisplay();
    this.calculateStats();
    this.showToast(`üé∞ Combinaci√≥n m√∫ltiple de ${numCount} n√∫meros generada`);
  }

  generateValidatedCombination() {
    let attempts = 0;
    const maxAttempts = 1000;
    
    while(attempts < maxAttempts) {
      const candidate = this.generateRandomCombination();
      if(this.validateCombination(candidate)) {
        return candidate;
      }
      attempts++;
    }
    
    // Si no se puede generar una v√°lida, devolver una aleatoria
    return this.generateRandomCombination();
  }

  generateRandomCombination() {
    const availableNumbers = Array.from({length: 49}, (_, i) => i + 1)
      .filter(num => !this.excludedNumbers.has(num));
    
    const selected = [];
    const tempAvailable = [...availableNumbers];
    
    while(selected.length < 6 && tempAvailable.length > 0) {
      const randomIndex = Math.floor(Math.random() * tempAvailable.length);
      selected.push(tempAvailable.splice(randomIndex, 1)[0]);
    }
    
    return selected.sort((a, b) => a - b);
  }

  validateCombination(combination) {
    if(combination.length !== 6) return false;
    
    // Validar Par/Impar
    const pares = combination.filter(n => n % 2 === 0).length;
    const parImparStr = `${pares}/${6-pares}`;
    if(!this.filters.parImpar.has(parImparStr)) return false;
    
    // Validar Bajos/Altos
    const bajos = combination.filter(n => n <= 25).length;
    const bajosAltosStr = `${bajos}/${6-bajos}`;
    if(!this.filters.bajosAltos.has(bajosAltosStr)) return false;
    
    // Validar suma
    const suma = combination.reduce((a, b) => a + b, 0);
    if(suma < 120 || suma > 200) return false;
    
    return true;
  }

  evaluateCombination(combination) {
    let score = 0;
    
    // Puntuaci√≥n por distribuci√≥n equilibrada
    const pares = combination.filter(n => n % 2 === 0).length;
    if(pares >= 2 && pares <= 4) score += 10;
    
    const bajos = combination.filter(n => n <= 25).length;
    if(bajos >= 2 && bajos <= 4) score += 10;
    
    // Puntuaci√≥n por suma √≥ptima
    const suma = combination.reduce((a, b) => a + b, 0);
    if(suma >= 140 && suma <= 180) score += 10;
    
    // Penalizar muchos consecutivos
    const consecutivos = this.getConsecutivos(combination);
    if(consecutivos <= 1) score += 5;
    else score -= consecutivos * 2;
    
    // Bonificar distribuci√≥n en decenas
    const decenas = this.getDecenas(combination);
    if(decenas >= 4) score += 5;
    
    return score;
  }

  updateNumberDisplay() {
    // Limpiar selecciones anteriores
    document.querySelectorAll('.number-ball.selected').forEach(ball => {
      ball.classList.remove('selected');
    });

    // Marcar n√∫meros seleccionados
    this.selectedNumbers.forEach(num => {
      const ball = document.querySelector(`.number-ball[data-number="${num}"]`);
      if(ball) ball.classList.add('selected');
    });
  }

  updateFilters() {
    // Actualizar filtros Par/Impar
    this.filters.parImpar = new Set();
    document.querySelectorAll('#parImparOptions .filter-chip.active').forEach(chip => {
      this.filters.parImpar.add(chip.dataset.value);
    });

    // Actualizar filtros Bajos/Altos
    this.filters.bajosAltos = new Set();
    document.querySelectorAll('#bajosAltosOptions .filter-chip.active').forEach(chip => {
      this.filters.bajosAltos.add(chip.dataset.value);
    });

    // Actualizar filtros Agrupaci√≥n Decenas
    this.filters.agrupDecenas = new Set();
    document.querySelectorAll('#agrupDecenasOptions .filter-chip.active').forEach(chip => {
      this.filters.agrupDecenas.add(chip.dataset.value);
    });
  }

  clearAll() {
    this.selectedNumbers = [];
    this.hotNumbers.clear();
    this.coldNumbers.clear();
    this.excludedNumbers.clear();

    document.querySelectorAll('.number-ball').forEach(ball => {
      ball.classList.remove('selected', 'hot', 'cold', 'excluded');
    });

    this.updateDisplay();
    this.clearStats();
    this.showToast('üóëÔ∏è Todo limpiado');
  }

  showLoadingModal() {
    document.getElementById('loadingModal').style.display = 'flex';
  }

  hideLoadingModal() {
    document.getElementById('loadingModal').style.display = 'none';
  }

  showToast(message, isError = false) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast ${isError ? 'error' : ''}`;
    toast.classList.add('show');

    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }
}

// Inicializar aplicaci√≥n cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
  window.app = new DataLotto49();
});
</script>
</body>
</html>
